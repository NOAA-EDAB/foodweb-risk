<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Food Web Model Risk Indicators</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="RiskIndicators_files/libs/clipboard/clipboard.min.js"></script>
<script src="RiskIndicators_files/libs/quarto-html/quarto.js"></script>
<script src="RiskIndicators_files/libs/quarto-html/popper.min.js"></script>
<script src="RiskIndicators_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="RiskIndicators_files/libs/quarto-html/anchor.min.js"></script>
<link href="RiskIndicators_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RiskIndicators_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RiskIndicators_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RiskIndicators_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RiskIndicators_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="RiskIndicators_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="RiskIndicators_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="RiskIndicators_files/libs/datatables-binding-0.23/datatables.js"></script>
<script src="RiskIndicators_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="RiskIndicators_files/libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="RiskIndicators_files/libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="RiskIndicators_files/libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="RiskIndicators_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="RiskIndicators_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Food Web Model Risk Indicators</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>We want to develop indicators of prey availability and predation pressure for the Mid-Atlantic EAFM risk assessment. We will use the MAB Rpath model by Brandon Beltz to characterize diet composition and predation mortality for fish species managed by the Mid Atlantic Fishery Management Council (MAFMC).</p>
<p>The current ecological risk elements are outlined below.</p>
</section>
<section id="food-web-prey-availability" class="level1">
<h1>Food web: Prey availability</h1>
<p>This element is applied at the species level.</p>
<p>Fish stocks and protected species stocks are managed using single species approaches, but fish and protected species stocks exist within a food web of predator and prey interactions. This element is one of two separating food web risks to achieving OY for Council managed species from two sources. This first element assesses prey availability for each species, and the second food web risk element assesses predation pressure on each species (see next element).</p>
<p>Proposed definition:</p>
<p>Risk of not achieving OY for Council managed species due to availability of prey.</p>
<p>Indicators:</p>
<p>Indicators of prey availability for each Council managed species could be based on food habits information for the Council managed species combined with population trends for key prey species (if available). Prey could include all species (Council managed, other-managed, and non-managed) or a subset as determined by the EOP and Council.</p>
<p>The MAB Rpath model was used to characterize prey into groups for each of the Council managed species.</p>
<p>Diet plots for each predator? Compare with diet comp from NEFSC diet database <a href="https://fwdp.shinyapps.io/tm2020/">here</a>?</p>
<p>Ratio of council managed prey to total prey?</p>
<p>Alternative indirect indicators of prey availability could include the fish condition indicators from the State of the Ecosystem report (shown below under Ecosystem Productivity). These would not rely on detailed diet information, instead reflecting the impact of environmental drivers including prey availability on fish growth.</p>
<p>Diet information was gathered from the Northeast Fisheries Science Center (NEFSC) food habits database and other sources <span class="citation" data-cites="smith_trophic_2010 johnson_growth_2008">[@smith_trophic_2010; @johnson_growth_2008]</span>.</p>
<p>Potential risk criteria:</p>
<div class="cell" data-warnings="false">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Risk Level</th>
<th style="text-align: left;">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Low</td>
<td style="text-align: left;">Prey availability high (not limiting) and/or good fish condition past 5 years</td>
</tr>
<tr class="even">
<td style="text-align: left;">Low-Moderate</td>
<td style="text-align: left;">Aggregate prey available for this species has stable or increasing trend, moderate condition</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Moderate-High</td>
<td style="text-align: left;">Aggregate prey available for this species has significant decreasing trend, poor condition</td>
</tr>
<tr class="even">
<td style="text-align: left;">High</td>
<td style="text-align: left;">Managed species highly dependent on prey with limited and declining availability, poor condition</td>
</tr>
</tbody>
</table>
</div>
<div style="page-break-after: always;"></div>
<section id="rpath-outputs" class="level2">
<h2 class="anchored" data-anchor-id="rpath-outputs">Rpath Outputs</h2>
<p>Indicators from models will be EPU specific since models are EPU specific</p>
<p>Indicators from NEFSC diet data can also be region specific</p>
<p>Steps: Load model</p>
<p>Get the new model that Sarah revised from here</p>
<p>https://github.com/Nyelab/MAB-Rpath/blob/balance_prep/outputs/MAB_Rpath.RData</p>
<p>and</p>
<p>https://github.com/Nyelab/MAB-Rpath/blob/balance_prep/outputs/MAB_params_Rpath.RData</p>
<p>Correction! July 2024</p>
<p>New model is at <code>git@github.com:Nyelab/MAB-Rpath.git</code> branch <code>max_clam_edits</code></p>
<p>New model is now in local directory for this repo</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load("fwmods/MAB Rpath - BALANCED - July 2022.RData")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#load("fwmods/MAB_Rpath.RData")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#load("fwmods/MAB_params_Rpath.RData")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"fwmods/MAB_Rpath_no_disc.RData"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"fwmods/MAB_params_Rpath_no_disc.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Is it in? Test view</p>
<div class="cell" data-fig.asp="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Rpath<span class="sc">::</span><span class="fu">webplot</span>(MAB.rpath, <span class="at">labels =</span> T, <span class="at">highlight =</span> <span class="st">"SummerFlounder"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Model parameters</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(MAB.rpath.params<span class="sc">$</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-14edbe12877252bb90d1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-14edbe12877252bb90d1">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66"],["AmLobster","RiverHerring","AtlCroaker","AtlMackerel","AtlScallop","Bacteria","BaleenWhales","BlackSeaBass","Bluefish","Butterfish","Cod","Fourspot","GelZooplankton","Goosefish","HMS","Illex","LgCopepods","LittleSkate","Loligo","Macrobenthos","Megabenthos","Mesopelagics","Micronekton","Microzooplankton","OceanPout","OceanQuahog","Odontocetes","OtherCephalopods","OtherDemersals","OtherPelagics","OtherShrimps","OtherSkates","Phytoplankton","RedHake","Scup","SeaBirds","Sharks","SilverHake","SmCopepods","SmFlatfishes","SmoothDogfish","SmPelagics","SouthernDemersals","SpinyDogfish","SummerFlounder","SurfClam","Weakfish","Windowpane","WinterFlounder","WinterSkate","YTFlounder","Krill","AtlMenhaden","Detritus","Fixed Gear","LG Mesh","HMS Fleet","Scallop Dredge","Trap","Other Dredge","Other","Clam Dredge","Pelagic","SM Mesh","Recreational","PurseSeine"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,3,3,3,3,3,3,3,3,3,3],[0.0818827295457929,0.105571185272989,0.678526818097067,0.325330835932307,2.43468436505021,7.157778,0.16,0.128363685158035,0.979021126418242,2.11855582685612,0.0419021657204,0.278610425019406,0.4683606,0.467392465847788,0.032,0.284943324215039,3.66550144651612,0.60408774384178,1.80124109212671,45,7.933486,null,3.5656191,4.72086,0.132588545363738,4.71132679516368,0.092475345,null,null,null,null,null,20.0455,0.397738034844413,1.56563722364439,0.002948594,0.2106240255,0.712633519724871,7.2422125026799,null,0.577613969308229,null,0.728677709081359,1.92635190773532,0.270059581268359,10.024907520202,0.318037287639158,0.206397879186706,0.196904047351502,0.313857831450617,0.220397679661336,0.52435575,1.775190819,null,null,null,null,null,null,null,null,null,null,null,null,null],[1.5,1.3,1.02,0.69,1.5,91.25,0.06,0.5,0.6,1.64,0.4,0.45,35,0.4,0.58,3,61,0.5,3,2.5,2.5,2.2,14.25,72,0.57,1.5,0.07,3,0.65,1.2,2,0.55,195.45,0.45,0.45,0.28,0.16,0.6,52.17,1.64,0.5,2,1.14,0.2,0.7,1.5,1.02,0.25,0.57,0.15,0.9,14.25,1.45,null,null,null,null,null,null,null,null,null,null,null,null,null],[15.533,9.4,3.727232558,2.17,6.66,380.2082,4.308693137,1.66,3.5,4.23,1.2,1.61,146,1.22,2.26333333333333,19,148,1.4,19,16.84234942,15.533,3.7,70.94690325,242.4242482,2,6.66,10.669826596,19,1.740893617,4,6.66,1.1,0,0.94,1.66,76.2,0.875,3.06,127.75,5.39,2.44,5.39,3.727232558,1.16,3.336863905,6.66,3.727232558,0.92,2.024,0.9,3.234412371,36.5,5.39,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.95,null,null,null,null,null,0.85,0.9,0.85,0.85,0.85,null,null,null,null,null,null,null,0.85,null,0.9,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0.029141369,0,0.015226466,0,0,0,0,0,-0.05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.006636141,0.010330339,0,0,0,0,0,0,0,0,-0.063053723,0,0,0,0,0,0,-0.010274643,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0.3,0.2,0.2,0.2,0.3,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.4,0.2,0.2,0.3,0.3,0.2,0.2,0.4,0.2,0.2,0.2,0.2,0.2,0.2,0.3,0.2,0,0.2,0.2,0.2,0.2,0.2,0.4,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0,null,null,null,null,null,null,null,null,null,null,null,null],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[2.38494462709465e-05,4.68873844969085e-05,2.95947349295259e-07,0.00212049513216525,0,0,0,0.000312916911775702,0.00505534949541729,0.000823634892208742,0.00284629247858914,0,0,0.00016887772714836,2.35552386147169e-05,0,0,1.71305871380617e-05,0.00096312403684153,0.00010708023749227,1.92203614110798e-05,0,0,0,7.85905040172081e-08,5.44867448565519e-05,0,0.00422450977603829,0.000432926803753802,0.00592087455075458,0,4.67312953412946e-06,0,2.19628751390874e-05,0.0112912188206914,0,5.57395852643239e-05,0.0001312874768016,0,0,8.12841692242459e-07,1.82433297510776e-06,4.66608047536662e-05,9.97808785551996e-06,0.000469780914245896,0.000133083063497472,0.00278402753929187,4.01067784340916e-06,0.000130626290071882,2.06165342766068e-05,3.79755910542261e-05,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[4.66889003584332e-05,8.79733901329744e-07,7.95733503009226e-05,0.00382729913150659,0.000129783182668944,0,0,0.000437593452797779,0.00144834159895824,0.0131770140600088,0.00964406429412087,1.99916279128865e-06,0,0.00464192777750677,1.42285373980226e-06,0.00049327733906611,0,0.000130579678144324,0.00277246783232669,5.63591449563345e-05,0.000157251987277873,0,0,0,0.000398638870659142,0,0,0.000121577671393611,0.0114830567303045,2.57720816677955e-05,0,1.22036269284012e-06,0,0.00304246177122351,0.0115448360480296,0,2.02054822901834e-05,0.0258654258262371,0,0,1.97696883402511e-05,0,7.00965486062295e-05,0.00133143874596643,0.019632476428012,7.37435929271338e-06,0.00487685635829923,0.0039391561849875,0.0135673245503021,0.000180193868304019,0.0366351985180118,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[8.438100718707e-06,0,0,6.18854285889334e-06,0.0284643578561228,0,0,2.3751121792725e-06,4.59461638175289e-08,5.71624332200433e-07,2.53332017776586e-05,0,0,0.0125872281035639,6.77030237428881e-07,0,0,6.64795120886444e-06,6.05699280193437e-06,1.20000569029311e-06,2.62649894105144e-05,0,0,0,0,0,0,3.99816228953538e-06,2.74752113943649e-06,0,0,6.21084026192243e-06,0,6.18921853777301e-06,1.55995901286837e-06,0,9.93247953114227e-07,6.72300485271195e-07,0,0,0,0,2.56622838498492e-06,0,0.000818737502045116,0,1.18314089813323e-06,1.06510740547097e-05,0.000138102000345945,4.005628563562e-06,0.000796507805334866,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0.0163935731586768,0,3.2432586224138e-08,1.4508508540362e-06,2.15149668864376e-05,0,0,0.00181978453344668,4.78380646806036e-07,0.00319345554075693,7.89218222769235e-06,0,0,0.000206125301747509,0,0,0,0,0,0.00202627744621943,0.00799667481619777,0,0,0,8.86420248356602e-05,0,0,2.10424623271831e-07,0.0440965553544607,0,0,0,0,0.000555131781777673,2.11174196223439e-06,0,0,0,0,0,0,0,0,0,0.023561448158145,0.000260618127713978,1.74325150954742e-07,0,1.15405952647558e-06,0,0.0176541168964642,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[1.11084441899971e-06,0,0,2.02703663900863e-07,0,0,0,0,0,4.05407327801725e-07,0,0,0,7.25679116765088e-07,0,0,0,0,2.63514763071121e-07,0.0142425405095111,0.000509617957092038,0,0,0,0,0,0,0,0.000171081892332328,0,0,0,0,4.92975310606898e-06,0,0,0,8.71625754773709e-06,0,0,0,0,0,0,0,5.35137672698277e-07,0,2.02703663900863e-07,5.55408039088364e-06,0,3.04055495851294e-07,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,1.29730344896552e-05,0,0,0,0,0,1.21622198340518e-07,0,7.08246601669614e-05,0,0,0,0,0,0,0,0,0,0.00233352187611121,3.08109569129311e-06,0,0,0,0,0,0,3.70339593946876e-05,0,0,0,0,0,0,6.60813944316812e-06,0,0,0,0,0,0,0,2.12879387828686e-05,0,2.00108603578862e-07,6.17516441707588e-05,0,0,1.53273365400982e-05,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[2.02703663900863e-08,0,0,0,1.34716855028513e-05,0,0,0,0,0,0,0,0,7.19780440145573e-05,0,0,0,0,0,6.94974777978458e-05,0.000165156864236506,0,0,0,0,0.132039254089497,0,0,0,0,0,0,0,1.01351831950431e-07,0,0,0,0,0,0,0,0,0,0,2.71643266857882e-07,0.163307723992593,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0.000156025064177772,5.91894698590519e-06,0.00232145116967694,2.43126146924392e-05,0,0,7.61063613048599e-07,0.000643028314498692,1.40203158619505e-05,1.93668445153756e-06,0,0,1.33016533734194e-05,1.96217146656035e-06,4.05407327801725e-08,0,8.2483503341456e-08,7.2704414106287e-06,1.86487370788794e-07,0,0,0,0,0,0,0,2.41988316762606e-06,0.000259638288272197,0.104007585084257,0,1.08508960072751e-06,0,5.68089101017844e-08,0.00122269624812595,0,5.02975358026007e-06,1.10330683319175e-05,0,0,0,0,3.33082660521898e-05,0,7.54957565100558e-06,0,0.00196029009077413,2.8219680792131e-07,6.07499158283721e-07,0,1.41464905654331e-07,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0.000184755220650576,9.73038397823311e-05,0.00029824534040384,0.0103951200610483,0.000193009086665667,0,0,0.0055528362008535,0.00392658265253428,0.049449183543621,0.00463839882147986,0,0,0.0103163625586549,6.39796307897935e-06,0.0231611162463482,0,0.000358093546053416,0.0281175476072155,0.000321803799207267,0.00177891364064866,1.6216293112069e-08,0,0,0.00260806569633711,0,0,0.00167219729827791,0.00551412485102352,0.000106277530983222,0,4.79156687561694e-05,0,0.00645353321908067,0.0310261258020999,0,4.65208516495897e-05,0.0722362330110268,0,0,2.81131013823187e-05,0,0.000210434979886215,0.00481859345734071,0.0488568998213982,2.39190323403018e-05,0.00604237124027288,0.00177365842351702,0.0175274740692656,0.000340990780059714,0.0317489960753296,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,4.30347714429885e-05,0.0030857480843706,0.0137692871059698,0,0,0,0.0155326965176605,0.307927488555539,4.08932725608211e-06,0.0409418661521022,0,0,8.73532149255709e-05,0,0,0,0,0,0,0,9.84846499164739e-06,0,0,0,0,0,0,0.0230560651270757,0.0142738843632003,0,0.00317248771422088,0,0.00266671364384691,0.00389054002313681,0,0.0235556408972603,0.000657207657065219,0,0,0.00100899016411909,0,0.0316940362746606,0.00702257005702089,0.0411182071559382,0,0.0299951335276534,0.000369871530630666,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.35,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Group<\/th>\n      <th>Type<\/th>\n      <th>Biomass<\/th>\n      <th>PB<\/th>\n      <th>QB<\/th>\n      <th>EE<\/th>\n      <th>ProdCons<\/th>\n      <th>BioAcc<\/th>\n      <th>Unassim<\/th>\n      <th>DetInput<\/th>\n      <th>Detritus<\/th>\n      <th>Fixed Gear<\/th>\n      <th>LG Mesh<\/th>\n      <th>HMS Fleet<\/th>\n      <th>Scallop Dredge<\/th>\n      <th>Trap<\/th>\n      <th>Other Dredge<\/th>\n      <th>Other<\/th>\n      <th>Clam Dredge<\/th>\n      <th>Pelagic<\/th>\n      <th>SM Mesh<\/th>\n      <th>Recreational<\/th>\n      <th>PurseSeine<\/th>\n      <th>Fixed Gear.disc<\/th>\n      <th>LG Mesh.disc<\/th>\n      <th>HMS Fleet.disc<\/th>\n      <th>Scallop Dredge.disc<\/th>\n      <th>Trap.disc<\/th>\n      <th>Other Dredge.disc<\/th>\n      <th>Other.disc<\/th>\n      <th>Clam Dredge.disc<\/th>\n      <th>Pelagic.disc<\/th>\n      <th>SM Mesh.disc<\/th>\n      <th>Recreational.disc<\/th>\n      <th>PurseSeine.disc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Select MAFMC managed species</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or use existing ecodata lookup if names are the same?</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mafmc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AtlMackerel"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"BlackSeaBass"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Bluefish"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Butterfish"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Goosefish"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Illex"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Loligo"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Scup"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">"SpinyDogfish"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">"SummerFlounder"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">"SurfClam"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>           <span class="st">"OceanQuahog"</span>)<span class="co">#,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>           <span class="co">#"Clams", # Atlantic surfclam and ocean quahog not separate groups</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>           <span class="co">#"Tilefish") # Blueline and golden tilefish not separate groups</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>mafmc2 <span class="ot">&lt;-</span> ecodata<span class="sc">::</span>species_groupings <span class="sc">|&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fed.Managed <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAFMC"</span>, <span class="st">"JOINT"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(COMNAME, SVSPP, SCINAME, Fed.Managed, RPATH, SOE<span class="fl">.20</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualize-prey-compositions-lots-of-aggregate-groups" class="level2">
<h2 class="anchored" data-anchor-id="visualize-prey-compositions-lots-of-aggregate-groups">Visualize prey compositions (lots of aggregate groups)</h2>
<p>These can be the basis for selecting aggregate prey indices.</p>
<div class="cell" data-fig.asp="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>MAFMCmoddiet <span class="ot">&lt;-</span> MAB.rpath.params<span class="sc">$</span>diet <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">Prey=</span>Group, <span class="fu">all_of</span>(mafmc)) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>Prey, <span class="at">names_to =</span> <span class="st">"Predator"</span>, <span class="at">values_to =</span> <span class="st">"Propdiet"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mafmcprey =</span> <span class="fu">ifelse</span>(Prey <span class="sc">%in%</span> mafmc, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">plotcol =</span> <span class="fu">ifelse</span>(mafmcprey, <span class="st">"blue"</span>, <span class="st">"lightgrey"</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>dietplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(MAFMCmoddiet, <span class="fu">aes</span>(<span class="st">""</span>, Propdiet, <span class="at">fill=</span>mafmcprey)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#coord_polar("y") +</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>( Propdiet<span class="sc">&gt;</span><span class="fl">0.05</span>, <span class="fu">paste0</span>(Prey, <span class="st">" "</span>, <span class="fu">round</span>(Propdiet<span class="sc">*</span><span class="dv">100</span>), <span class="st">"%"</span>), <span class="st">""</span>)), <span class="co">#\n</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">"grey90"</span>, <span class="st">"lightblue"</span>)) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_fill_viridis(discrete=TRUE) +</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"#666666"</span>),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Predator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dietplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="review-fish-condition-trends" class="level2">
<h2 class="anchored" data-anchor-id="review-fish-condition-trends">Review fish condition trends</h2>
<p>Which are “good” in the last 5 years?</p>
<p>Use ecodata fall condition as a starting point, ask for stock specific condition if available</p>
<div class="cell" data-fig.asp="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mafmc_cond <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Atlantic mackerel"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Black sea bass"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Bluefish"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Butterfish"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Goosefish"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Illex"</span>, <span class="co">#not in condition</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Loligo"</span>,  <span class="co">#not in condition</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Scup"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Spiny dogfish"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Summer flounder"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Surf clam"</span>,  <span class="co">#not in condition</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Ocean quahog"</span>)  <span class="co">#not in condition</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>           <span class="co">#"Clams", # Atlantic surfclam and ocean quahog not separate groups</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>           <span class="co">#"Tilefish") # Blueline and golden tilefish not separate groups</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>fix<span class="ot">&lt;-</span> ecodata<span class="sc">::</span>condition <span class="sc">|&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">group_by</span>(EPU, Var) <span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scaleCond =</span> <span class="fu">scale</span>(Value,<span class="at">scale =</span>T,<span class="at">center=</span>T))</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>   <span class="co"># finds quantiles</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>   xs <span class="ot">&lt;-</span> <span class="fu">quantile</span>(fix<span class="sc">$</span>scaleCond, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">6</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>   <span class="co"># labels quantiles</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>   fix <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">cut</span>(scaleCond,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">breaks =</span> xs,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">labels =</span> <span class="fu">c</span>( <span class="st">"Poor Condition"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Below Average"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Neutral"</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Above Average"</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Good Condition"</span>),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>mafmccond5 <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> mafmc_cond,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                Time <span class="sc">&gt;</span> <span class="fu">max</span>(Time, <span class="at">na.rm =</span> T)<span class="sc">-</span><span class="dv">5</span>) </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>condquants <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ymin =</span> xs[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> xs[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                         <span class="at">category =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(fix<span class="sc">$</span>category))</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>vir <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>()(<span class="dv">5</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>mafmccondall <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> mafmc_cond) </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> mafmccondall, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Updated condition dataset with survey strata based EPU definitions</p>
<div class="cell" data-fig.asp="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>AnnualRelCond2023_Fall <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"condition/AnnualRelCond2023_Fall.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3414 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Species, EPU
dbl (4): YEAR, MeanCond, nCond, n

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>survEPUcond <span class="ot">&lt;-</span> AnnualRelCond2023_Fall <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">Time =</span> YEAR,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">Var =</span> Species,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                EPU,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">Value =</span> MeanCond,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                nCond) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(EPU, Var) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scaleCond =</span> <span class="fu">scale</span>(Value,<span class="at">scale =</span>T,<span class="at">center=</span>T)) <span class="sc">|&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">cut</span>(scaleCond,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">breaks =</span> xs,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">labels =</span> <span class="fu">c</span>( <span class="st">"Poor Condition"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Below Average"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Neutral"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Above Average"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Good Condition"</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>mafmcsurvEPUcond <span class="ot">&lt;-</span> survEPUcond <span class="sc">|&gt;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> mafmc_cond)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> mafmcsurvEPUcond, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Condition comparison?</p>
<p><code>ecodata::condition</code> missing EPU values</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ecodata<span class="sc">::</span>condition <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.na</span>(EPU)) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Var) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 1
   Var                
   &lt;chr&gt;              
 1 Atlantic croaker   
 2 Blackbelly rosefish
 3 Butterfish         
 4 Fourspot           
 5 Goosefish          
 6 Haddock            
 7 Offshore hake      
 8 Red hake           
 9 Rosette skate      
10 Scup               
11 Silver hake        
12 Spot               
13 Spotted hake       
14 Weakfish           </code></pre>
</div>
</div>
<p>Survey strata based EPU condition missing EPU values</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>survEPUcond <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.na</span>(EPU)) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Var) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `EPU`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
# Groups:   EPU, Var [4]
  EPU   Var             
  &lt;chr&gt; &lt;chr&gt;           
1 &lt;NA&gt;  Atlantic croaker
2 &lt;NA&gt;  Butterfish      
3 &lt;NA&gt;  Scup            
4 &lt;NA&gt;  Spotted hake    </code></pre>
</div>
</div>
<div class="cell" data-fig.asp="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>compfix <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">ecodataValue =</span> Value,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">ecodataScaleCond =</span> scaleCond,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">ecodataCategory =</span> category)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>compcond <span class="ot">&lt;-</span> survEPUcond <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(compfix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Time, Var, EPU)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>  compcond <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>scaleCond, <span class="at">y=</span>ecodataScaleCond), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_smooth(data=bsbcondprey, ggplot2::aes(x=scaleMacro, y=scaleCond), method="lm", col="blue") +</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">method=</span><span class="st">"pearson"</span>, <span class="at">label.x =</span> <span class="dv">0</span>, <span class="at">label.y =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 179 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 179 rows containing non-finite values (`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 179 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="prey-indicators" class="level2">
<h2 class="anchored" data-anchor-id="prey-indicators">Prey indicators</h2>
<p>Macrobenthos (fall)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fallmacro <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"preyindices/fallmacrobenthosindex.rds"</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>macroprey <span class="ot">&lt;-</span> fallmacro <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_detect</span>(Var, <span class="st">"Fall "</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(Var, <span class="st">"SE"</span>)) </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span>macroprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>Value)) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Megabenthos (fall)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fallmega <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"preyindices/fallmegabenthosindex.rds"</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>megaprey <span class="ot">&lt;-</span> fallmega <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_detect</span>(Var, <span class="st">"Fall "</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(Var, <span class="st">"SE"</span>)) </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span>megaprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>Value)) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Small copeopods (fall)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fallsmcope <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"preyindices/fallsmcopepodALLindex.rds"</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>smcopeprey <span class="ot">&lt;-</span> fallsmcope <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_detect</span>(Var, <span class="st">"Fall "</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(Var, <span class="st">"SE"</span>))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span>smcopeprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>Value)) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Forage fish (fall)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ecodata::plot_forage_index(report = "MidAtlantic")</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ecodata::plot_forage_index(report = "NewEngland")</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>foragefishprey <span class="ot">&lt;-</span> ecodata<span class="sc">::</span>forage_index <span class="sc">|&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">str_detect</span>(Var, <span class="st">"Fall "</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(Var, <span class="st">"SE"</span>)) </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span>foragefishprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>Value)) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="combine-condition-and-prey-index-indicators" class="level2">
<h2 class="anchored" data-anchor-id="combine-condition-and-prey-index-indicators">Combine condition and prey index indicators</h2>
<p>Are predator condition time series correlated with major prey?</p>
<p>Highest risk might be significant decreasing prey correlated with decrease in or current poor condition?</p>
<p>Lets look at a benthivore, a planktivore, and a piscivore as examples.</p>
<section id="black-sea-bass" class="level3">
<h3 class="anchored" data-anchor-id="black-sea-bass">Black sea bass</h3>
<p>Macrobenthos correlated with condition? Yes in the Mid. Both are declining recently. Not significant in GOM.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>macrojoin <span class="ot">&lt;-</span> macroprey <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Time, <span class="at">FallMacroB =</span> Value, EPU)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>megajoin <span class="ot">&lt;-</span> megaprey <span class="sc">|&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Time, <span class="at">FallMegaB =</span> Value, EPU)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>bsbcondprey <span class="ot">&lt;-</span> mafmccondall <span class="sc">|&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">==</span> <span class="st">"Black sea bass"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(macrojoin) <span class="sc">|&gt;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(megajoin) <span class="sc">|&gt;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scaleMacro =</span> <span class="fu">scale</span>(FallMacroB,<span class="at">scale =</span>T,<span class="at">center=</span>T),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">scaleMega =</span> <span class="fu">scale</span>(FallMegaB,<span class="at">scale =</span>T,<span class="at">center=</span>T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Time, EPU)`
Joining with `by = join_by(Time, EPU)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data=</span>bsbcondprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>scaleMacro, <span class="at">y=</span>scaleCond), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_smooth(data=bsbcondprey, ggplot2::aes(x=scaleMacro, y=scaleCond), method="lm", col="blue") +</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">method=</span><span class="st">"pearson"</span>, <span class="at">label.x =</span> <span class="dv">0</span>, <span class="at">label.y =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Megabenthos correlated with condition? No, these are not significantly correlated.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data=</span>bsbcondprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>scaleMega, <span class="at">y=</span>scaleCond), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_smooth(data=bsbcondprey, ggplot2::aes(x=scaleMega, y=scaleCond), method="lm", col="red") +</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">method=</span><span class="st">"pearson"</span>, <span class="at">label.x =</span> <span class="dv">0</span>, <span class="at">label.y =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Black sea bass condition and macrobenthos in MAB as time series:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data=</span>bsbcondprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond)) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span>bsbcondprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleMacro), <span class="at">col=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">data=</span>bsbcondprey, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleMacro), <span class="at">col=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>bsbcondall <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Black sea bass"</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>)) </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> bsbcondall, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Scaled condition"</span>) <span class="sc">+</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Black sea bass"</span>) <span class="sc">+</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fallmacro <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"preyindices/fallmacrobenthosindex.rds"</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>fixmacro<span class="ot">&lt;-</span> fallmacro <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fall Macrobenthos Biomass Index Estimate"</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                    EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(EPU) <span class="sc">|&gt;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">max =</span> <span class="fu">max</span>(Value))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> fallmacro <span class="sc">|&gt;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fall Macrobenthos Biomass Index Estimate"</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Fall Macrobenthos Biomass Index Estimate SE"</span>),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                    EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(EPU) <span class="sc">|&gt;</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">separate</span>(Var, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Season"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"Var"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Var =</span> tidyr<span class="sc">::</span><span class="fu">replace_na</span>(Var, <span class="st">"Mean"</span>)) <span class="sc">|&gt;</span> <span class="co">#,</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">#max = as.numeric(Value)) |&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Var, <span class="at">values_from =</span> Value) <span class="sc">|&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">left_join</span>(fixmacro) <span class="sc">|&gt;</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="co">#Value = Value/resca,</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">Mean =</span> <span class="fu">as.numeric</span>(Mean),</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#max = as.numeric(Value),</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">Mean =</span> Mean<span class="sc">/</span>max,</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">SE =</span> SE<span class="sc">/</span>max,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">Upper =</span> Mean <span class="sc">+</span> SE,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">Lower =</span> Mean <span class="sc">-</span> SE) <span class="sc">|&gt;</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Mean, <span class="at">group =</span> Season))<span class="sc">+</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">#ggplot2::annotate("rect", fill = setup$shade.fill, alpha = setup$shade.alpha,</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                  xmin = setup$x.shade.min , xmax = setup$x.shade.max,</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                  ymin = -Inf, ymax = Inf) +</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> Lower, <span class="at">ymax =</span> Upper, <span class="at">fill =</span> Season), <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Macrofauna prey"</span>)<span class="sc">+</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">"Relative macrofauna biomass"</span>))<span class="sc">+</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">xlab</span>(ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(.<span class="sc">~</span>EPU)<span class="sc">+</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>      ecodata<span class="sc">::</span><span class="fu">geom_gls</span>()<span class="sc">+</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>      ecodata<span class="sc">::</span><span class="fu">theme_ts</span>()<span class="sc">+</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>      ecodata<span class="sc">::</span><span class="fu">theme_facet</span>()<span class="sc">+</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>      ecodata<span class="sc">::</span><span class="fu">theme_title</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 6 pieces. Missing pieces filled with `NA` in 43 rows [1, 3, 5, 7, 9,
11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(EPU)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>  p </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What if we summed macrobenthos and megabenthos by EPU (indices are theoretically on the same scale of g/stomach). This would now account for the majority of BSB diet, ~75%. Doing this just weakens the correlation with macrobenthos alone.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> bsbcondprey <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FallTotBen =</span> FallMacroB <span class="sc">+</span> FallMegaB,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">scaleTotBen =</span> <span class="fu">scale</span>(FallTotBen,<span class="at">scale =</span>T,<span class="at">center=</span>T)) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>scaleTotBen, <span class="at">y=</span>scaleCond), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_smooth(data=bsbcondprey, ggplot2::aes(x=scaleMacro, y=scaleCond), method="lm", col="blue") +</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">method=</span><span class="st">"pearson"</span>, <span class="at">label.x =</span> <span class="dv">0</span>, <span class="at">label.y =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>p  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What about a zooplankton eater?</p>
</section>
<section id="atlantic-mackerel" class="level3">
<h3 class="anchored" data-anchor-id="atlantic-mackerel">Atlantic mackerel</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>smcopejoin <span class="ot">&lt;-</span> smcopeprey <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Time, <span class="at">FallSmCopeN =</span> Value, EPU)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>mackcondprey <span class="ot">&lt;-</span> mafmccondall <span class="sc">|&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">==</span> <span class="st">"Atlantic mackerel"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">is.na</span>(EPU)) <span class="sc">|&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(macrojoin) <span class="sc">|&gt;</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(smcopejoin) <span class="sc">|&gt;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scaleMacro =</span> <span class="fu">scale</span>(FallMacroB,<span class="at">scale =</span>T,<span class="at">center=</span>T),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">scaleSmCope =</span> <span class="fu">scale</span>(FallSmCopeN,<span class="at">scale =</span>T,<span class="at">center=</span>T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Time, EPU)`
Joining with `by = join_by(Time, EPU)`</code></pre>
</div>
</div>
<p>Condition has been Above average (3), good or neutral (1 each) for the past 5 observations (MAB)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mackcondmab <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Atlantic mackerel"</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>)) </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>mackcondall <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Atlantic mackerel"</span>)) </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> mackcondmab, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Scaled condition"</span>) <span class="sc">+</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Atlantic mackerel"</span>) <span class="sc">+</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Recent condition differs across regions? Yes, GB has similar status to MAB, but GOM has below average, or poor for the most recent 5 observations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> mackcondall, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Scaled condition"</span>) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Atlantic mackerel"</span>) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Small copeopods make up the largest proportion in food web model diets, but are uncorrelated with condition in any region:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> mackcondprey <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(EPU <span class="sc">!=</span> <span class="st">"SS"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>scaleSmCope, <span class="at">y=</span>scaleCond), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_smooth(data=bsbcondprey, ggplot2::aes(x=scaleMacro, y=scaleCond), method="lm", col="blue") +</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">method=</span><span class="st">"pearson"</span>, <span class="at">label.x =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">label.y =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>p  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite values (`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How about a piscivore?</p>
</section>
<section id="bluefish" class="level3">
<h3 class="anchored" data-anchor-id="bluefish">Bluefish</h3>
<p>Condition in MAB has been good (4) or neutral (1) in the past 5 observations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>foragejoin <span class="ot">&lt;-</span> foragefishprey <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Time, <span class="at">FallForageB =</span> Value, EPU)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>bluecondprey <span class="ot">&lt;-</span> mafmccondall <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">==</span> <span class="st">"Bluefish"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">is.na</span>(EPU)) <span class="sc">|&gt;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(macrojoin) <span class="sc">|&gt;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(foragejoin) <span class="sc">|&gt;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scaleMacro =</span> <span class="fu">scale</span>(FallMacroB,<span class="at">scale =</span>T,<span class="at">center=</span>T),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">scaleForage =</span> <span class="fu">scale</span>(FallForageB,<span class="at">scale =</span>T,<span class="at">center=</span>T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(Time, EPU)`
Joining with `by = join_by(Time, EPU)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>bluecondmab <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bluefish"</span>),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                EPU <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MAB"</span>)) </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>bluecondall <span class="ot">&lt;-</span> fix <span class="sc">|&gt;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bluefish"</span>)) </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> bluecondmab, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Scaled condition"</span>) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Bluefish"</span>) <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Observations of condition are only in GB outside the mid, and are less recent, but also good or above average for the most recent 5.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>   ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_rect</span>(<span class="at">data =</span> condquants,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> category, <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>vir) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data=</span> bluecondall, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>scaleCond[,<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_hline(yintercept = xs[2:5]) +</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_line() +</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(Var<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>, <span class="st">"SS"</span>, <span class="st">"NA"</span>)), ) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Scaled condition"</span>) <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Bluefish"</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Correlation with forage fish index? Theoretically covering 60+% of diet? No.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> bluecondprey <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(EPU <span class="sc">!=</span> <span class="st">"SS"</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>scaleForage, <span class="at">y=</span>scaleCond), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::geom_smooth(data=bsbcondprey, ggplot2::aes(x=scaleMacro, y=scaleCond), method="lm", col="blue") +</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">method=</span><span class="st">"pearson"</span>, <span class="at">label.x =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">label.y =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">factor</span>(EPU, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAB"</span>, <span class="st">"GB"</span>, <span class="st">"GOM"</span>)))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>p  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing non-finite values (`stat_cor()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="suggested-risk-criteria-prey-availability" class="level2">
<h2 class="anchored" data-anchor-id="suggested-risk-criteria-prey-availability">Suggested risk criteria, prey availability</h2>
<p>This suggests that good condition is low risk, and being uncorrelated with your major prey trend is low risk.</p>
<p>Conversely, poor condition indicates eleveted risk of prey availability, and higher risk if poor condition coincides with decreasing trends in major prey. If these are correlated that may be highest risk, indicating that the predator condition has a history of fluctuating with the prey index.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="food-web-predation-pressure" class="level1">
<h1>Food web: Predation pressure</h1>
<p>This element is applied at the species level.</p>
<p>Fish stocks and protected species stocks are managed using single species approaches, but fish and protected species stocks exist within a food web of predator and prey interactions. This element is one of two separating food web risks to achieving OY for Council managed species from two sources. This second food web risk element assesses predation pressure on each species, and the first element assesses prey availability for each species (see element above).</p>
<p>Proposed definition:</p>
<p>Risk of not achieving OY for Council managed species due to predation pressure.</p>
<p>Indicators:</p>
<p>Indicators of predation pressure on a Council managed species could be based on food habits information for predators of the species combined with key predator trends. This could be derived from empirical information or food web/multispecies models. Predators could include all species (protected, HMS, Council managed, other-managed, and unmanaged) or a subset as determined by the EOP and Council.</p>
<p>Mortality plots for each species from Rpath? Compare with index of predation from <a href="https://www.sciencedirect.com/science/article/abs/pii/S0165783616300595">Richards, R.A., Jacobson, L.D., 2016. A simple predation pressure index for modeling changes in natural mortality: Application to Gulf of Maine northern shrimp stock assessment. Fisheries Research 179, 224–236. https://doi.org/10.1016/j.fishres.2016.03.003</a></p>
<p>Ratio of Council managed predators to total predators (proportion of mortality)?</p>
<p>Potential risk criteria:</p>
<div class="cell" data-warnings="false">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Risk Level</th>
<th style="text-align: left;">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Low</td>
<td style="text-align: left;">Predation pressure represents low proportion of overall mortality</td>
</tr>
<tr class="even">
<td style="text-align: left;">Low-Moderate</td>
<td style="text-align: left;">Predation pressure moderate proportion of overall mortality, decreasing mortality trend</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Moderate-High</td>
<td style="text-align: left;">Predation pressure moderate proportion of overall mortality, increasing mortality trend</td>
</tr>
<tr class="even">
<td style="text-align: left;">High</td>
<td style="text-align: left;">Predation pressure represents high proportion of overall mortality, increasing mortality trend</td>
</tr>
</tbody>
</table>
</div>
<p>Visualize predation mortality compositions</p>
<p>Sean’s prebal functions, from <a href="https://github.com/NOAA-EDAB/GBRpath/blob/master/R/PreBal.R">GBRpath repo</a>. These allow us to track predation mortality by species efficiently.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pre-balance functions</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SML</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table); <span class="fu">library</span>(ggplot2)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>check.ee <span class="ot">&lt;-</span> <span class="cf">function</span>(rpath.obj){</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  model.out <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">as.data.table</span>(Rpath<span class="sc">::</span><span class="fu">write.Rpath</span>(rpath.obj))</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setorder</span>(model.out, <span class="sc">-</span>EE)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> model.out[, .(Group, EE)]</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>check.mort <span class="ot">&lt;-</span> <span class="cf">function</span>(rpath.obj, group){</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  model.out <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">as.data.table</span>(Rpath<span class="sc">::</span><span class="fu">write.Rpath</span>(rpath.obj, <span class="at">morts =</span> T))</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  group.mort <span class="ot">&lt;-</span> model.out[Group <span class="sc">==</span> group]</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt</span>(group.mort, <span class="at">id.vars =</span> <span class="st">'Group'</span>)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">setorder</span>(out[value <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'PB'</span>, <span class="st">'M0'</span>), ], <span class="sc">-</span>value)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>pbcalc <span class="ot">&lt;-</span> <span class="cf">function</span>(lifespan){</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>lifespan <span class="sc">*</span> <span class="fl">2.5</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pb)</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>lscalc <span class="ot">&lt;-</span> <span class="cf">function</span>(pb){</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  life <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (pb <span class="sc">/</span> <span class="fl">2.5</span>)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(life)</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>prebal <span class="ot">&lt;-</span> <span class="cf">function</span>(rpath.obj, spClasses){</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">as.data.table</span>(Rpath<span class="sc">::</span><span class="fu">write.Rpath</span>(rpath.obj))</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>  living <span class="ot">&lt;-</span> model[type <span class="sc">&lt;</span> <span class="dv">2</span>, ]</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Biomass Range----</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>  max.bio <span class="ot">&lt;-</span> <span class="fu">max</span>(living[, Biomass])</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>  min.bio <span class="ot">&lt;-</span> <span class="fu">min</span>(living[, Biomass])</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>  bio.mag <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">log</span>(max.bio, <span class="at">base =</span> <span class="dv">10</span>)) <span class="sc">-</span> <span class="fu">round</span>(<span class="fu">log</span>(min.bio, <span class="at">base =</span> <span class="dv">10</span>))</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Slope of Biomass----</span></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a>  bio.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[, Biomass], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> living[, TL])</span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Slope by Trophic level----</span></span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>  TL.level <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fl">5.5</span>, .<span class="dv">25</span>))</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(iTL <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(TL.level) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a>    living[TL <span class="sc">&gt;=</span> TL.level[iTL] <span class="sc">&amp;</span> TL <span class="sc">&lt;</span> TL.level[iTL <span class="sc">+</span> <span class="dv">1</span>], TL.group <span class="sc">:</span><span class="er">=</span> TL.level[iTL]]</span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a>    living[TL <span class="sc">&gt;=</span> TL.level[iTL] <span class="sc">&amp;</span> TL <span class="sc">&lt;</span> TL.level[iTL <span class="sc">+</span> <span class="dv">1</span>], TL.bio <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>(Biomass)][]</span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a>  TL.model <span class="ot">&lt;-</span> <span class="fu">unique</span>(living[, .(TL.group, TL.bio)])</span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a>  TL.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(TL.model[, TL.bio], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> TL.model[, TL.group])</span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Not from prebal but look at F----</span></span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a>  living[, Fmort <span class="sc">:</span><span class="er">=</span> Removals <span class="sc">/</span> Biomass]</span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a>  Bad.F <span class="ot">&lt;-</span> living[Fmort <span class="sc">&gt;</span> <span class="dv">1</span>, .(Group, Biomass, Removals, Fmort)]</span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Predator Prey ratios----</span></span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a>  ratio.tab <span class="ot">&lt;-</span> <span class="fu">merge</span>(living[, .(Group, Biomass, TL)], spClasses, <span class="at">by =</span> <span class="st">'Group'</span>, </span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> T)</span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true" tabindex="-1"></a>  PredPrey <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">Ratio =</span> <span class="fu">c</span>(<span class="st">'SP:ZP'</span>, <span class="st">'ZP:PP'</span>, <span class="st">'SP:PP'</span>, <span class="st">'DM:BI'</span>, <span class="st">'SH:SP'</span>, </span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">'MB:SP'</span>, <span class="st">'W:ZP'</span>),</span>
<span id="cb71-63"><a href="#cb71-63" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Value =</span> <span class="fu">c</span>(ratio.tab[Classification <span class="sc">==</span> <span class="st">'Pelagic (Small; Round)'</span>, </span>
<span id="cb71-64"><a href="#cb71-64" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">sum</span>(Biomass)] <span class="sc">/</span></span>
<span id="cb71-65"><a href="#cb71-65" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Zoop <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-66"><a href="#cb71-66" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[Zoop <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-67"><a href="#cb71-67" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Group <span class="sc">==</span> <span class="st">'Phytoplankton'</span>, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-68"><a href="#cb71-68" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[Classification <span class="sc">==</span> <span class="st">'Pelagic (Small; Round)'</span>, </span>
<span id="cb71-69"><a href="#cb71-69" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">sum</span>(Biomass)] <span class="sc">/</span></span>
<span id="cb71-70"><a href="#cb71-70" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Group <span class="sc">==</span> <span class="st">'Phytoplankton'</span>, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-71"><a href="#cb71-71" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[type <span class="sc">==</span> <span class="st">'Demersal'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span></span>
<span id="cb71-72"><a href="#cb71-72" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Classification <span class="sc">==</span> <span class="st">'Invertebrate (Benthic)'</span>, </span>
<span id="cb71-73"><a href="#cb71-73" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-74"><a href="#cb71-74" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[Classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Shark'</span>, <span class="st">'HMS'</span>), </span>
<span id="cb71-75"><a href="#cb71-75" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">sum</span>(Biomass)] <span class="sc">/</span></span>
<span id="cb71-76"><a href="#cb71-76" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Classification <span class="sc">==</span> <span class="st">'Pelagic (Small; Round)'</span>, </span>
<span id="cb71-77"><a href="#cb71-77" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-78"><a href="#cb71-78" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[Classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mammal'</span>, <span class="st">'Bird'</span>), </span>
<span id="cb71-79"><a href="#cb71-79" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-80"><a href="#cb71-80" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Classification <span class="sc">==</span> <span class="st">'Pelagic (Small; Round)'</span>, </span>
<span id="cb71-81"><a href="#cb71-81" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-82"><a href="#cb71-82" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[Classification <span class="sc">==</span> <span class="st">'Whale'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-83"><a href="#cb71-83" aria-hidden="true" tabindex="-1"></a>                                     ratio.tab[Zoop <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)]))</span>
<span id="cb71-84"><a href="#cb71-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-85"><a href="#cb71-85" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Energy flows</span></span>
<span id="cb71-86"><a href="#cb71-86" aria-hidden="true" tabindex="-1"></a>  Fish <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">Ratio =</span> <span class="fu">c</span>(<span class="st">'DM:PL'</span>, <span class="st">'FF:RF'</span>, <span class="st">'SP:AF'</span>, <span class="st">'HMS:AF'</span>, <span class="st">'Sharks:AF'</span>, </span>
<span id="cb71-87"><a href="#cb71-87" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'DM:AF'</span>),</span>
<span id="cb71-88"><a href="#cb71-88" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Value =</span> <span class="fu">c</span>(ratio.tab[type <span class="sc">==</span> <span class="st">'Demersal'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span></span>
<span id="cb71-89"><a href="#cb71-89" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Classification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Pelagic (Small; Round)'</span>, </span>
<span id="cb71-90"><a href="#cb71-90" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="st">'Shark'</span>, </span>
<span id="cb71-91"><a href="#cb71-91" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="st">'HMS'</span>,</span>
<span id="cb71-92"><a href="#cb71-92" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="st">'Pelagic (Medium; Round'</span>),</span>
<span id="cb71-93"><a href="#cb71-93" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-94"><a href="#cb71-94" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[RF <span class="sc">==</span> <span class="st">'Flat'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-95"><a href="#cb71-95" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[RF <span class="sc">==</span> <span class="st">'Round'</span>, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-96"><a href="#cb71-96" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[Classification <span class="sc">==</span> <span class="st">'Pelagic (Small; Round)'</span>, </span>
<span id="cb71-97"><a href="#cb71-97" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">sum</span>(Biomass)] <span class="sc">/</span></span>
<span id="cb71-98"><a href="#cb71-98" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[fish <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-99"><a href="#cb71-99" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[Classification <span class="sc">==</span> <span class="st">'HMS'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-100"><a href="#cb71-100" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[fish <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-101"><a href="#cb71-101" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[Classification <span class="sc">==</span> <span class="st">'Shark'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-102"><a href="#cb71-102" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[fish <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-103"><a href="#cb71-103" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[type <span class="sc">==</span> <span class="st">'Demersal'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-104"><a href="#cb71-104" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[fish <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)]))</span>
<span id="cb71-105"><a href="#cb71-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-106"><a href="#cb71-106" aria-hidden="true" tabindex="-1"></a>  Invert <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">Ratio =</span> <span class="fu">c</span>(<span class="st">'BI:AI'</span>, <span class="st">'PI:AI'</span>, <span class="st">'GZ:AI'</span>, <span class="st">'SM:AI'</span>, <span class="st">'ZP:AI'</span>, <span class="st">'PP:AI'</span>, </span>
<span id="cb71-107"><a href="#cb71-107" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">'ZP:BI'</span>),</span>
<span id="cb71-108"><a href="#cb71-108" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Value =</span> <span class="fu">c</span>(ratio.tab[Classification <span class="sc">==</span> <span class="st">'Invertebrate (Benthic)'</span>, </span>
<span id="cb71-109"><a href="#cb71-109" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-110"><a href="#cb71-110" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[invert <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-111"><a href="#cb71-111" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Classification <span class="sc">==</span> <span class="st">'Invertebrate (Pelagic)'</span>, </span>
<span id="cb71-112"><a href="#cb71-112" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-113"><a href="#cb71-113" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[invert <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-114"><a href="#cb71-114" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Group <span class="sc">==</span> <span class="st">'GelZooplankton'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-115"><a href="#cb71-115" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[invert <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-116"><a href="#cb71-116" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'OtherShrimps'</span>, <span class="st">'Micronekton'</span>, <span class="st">'Krill'</span>), </span>
<span id="cb71-117"><a href="#cb71-117" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-118"><a href="#cb71-118" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[invert <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-119"><a href="#cb71-119" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Zoop <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-120"><a href="#cb71-120" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[invert <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-121"><a href="#cb71-121" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Group <span class="sc">==</span> <span class="st">'Phytoplankton'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-122"><a href="#cb71-122" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[invert <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-123"><a href="#cb71-123" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[Zoop <span class="sc">==</span> T, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-124"><a href="#cb71-124" aria-hidden="true" tabindex="-1"></a>                                   ratio.tab[Classification <span class="sc">==</span> <span class="st">'Invertebrate (Benthic)'</span>, </span>
<span id="cb71-125"><a href="#cb71-125" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">sum</span>(Biomass)]))</span>
<span id="cb71-126"><a href="#cb71-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-127"><a href="#cb71-127" aria-hidden="true" tabindex="-1"></a>  Diet <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">Ratio =</span> <span class="fu">c</span>(<span class="st">'Pisc:Benth'</span>, <span class="st">'Benth:Plank'</span>, </span>
<span id="cb71-128"><a href="#cb71-128" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'Pisc:Plank'</span>, <span class="st">'TL &gt; 4:TL &lt; 3'</span>),</span>
<span id="cb71-129"><a href="#cb71-129" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Value =</span> <span class="fu">c</span>(ratio.tab[diet <span class="sc">==</span> <span class="st">'Pisc'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-130"><a href="#cb71-130" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[diet <span class="sc">==</span> <span class="st">'Benth'</span>, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-131"><a href="#cb71-131" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[diet <span class="sc">==</span> <span class="st">'Benth'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-132"><a href="#cb71-132" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[diet <span class="sc">==</span> <span class="st">'Plank'</span>, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-133"><a href="#cb71-133" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[diet <span class="sc">==</span> <span class="st">'Pisc'</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-134"><a href="#cb71-134" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[diet <span class="sc">==</span> <span class="st">'Plank'</span>, <span class="fu">sum</span>(Biomass)],</span>
<span id="cb71-135"><a href="#cb71-135" aria-hidden="true" tabindex="-1"></a>                               ratio.tab[TL <span class="sc">&gt;=</span> <span class="dv">4</span>, <span class="fu">sum</span>(Biomass)] <span class="sc">/</span> </span>
<span id="cb71-136"><a href="#cb71-136" aria-hidden="true" tabindex="-1"></a>                                 ratio.tab[TL <span class="sc">&lt;=</span> <span class="dv">3</span>, <span class="fu">sum</span>(Biomass)]))</span>
<span id="cb71-137"><a href="#cb71-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-138"><a href="#cb71-138" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Vital Rates (Criteria 3)-----</span></span>
<span id="cb71-139"><a href="#cb71-139" aria-hidden="true" tabindex="-1"></a>  <span class="co">#QB</span></span>
<span id="cb71-140"><a href="#cb71-140" aria-hidden="true" tabindex="-1"></a>  cons.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[Group <span class="sc">!=</span> <span class="st">'Phytoplankton'</span>, QB], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> </span>
<span id="cb71-141"><a href="#cb71-141" aria-hidden="true" tabindex="-1"></a>                   living[Group <span class="sc">!=</span> <span class="st">'Phytoplankton'</span>, TL])</span>
<span id="cb71-142"><a href="#cb71-142" aria-hidden="true" tabindex="-1"></a>  cons.slope <span class="ot">&lt;-</span> cons.mod<span class="sc">$</span>coef[<span class="dv">2</span>]</span>
<span id="cb71-143"><a href="#cb71-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-144"><a href="#cb71-144" aria-hidden="true" tabindex="-1"></a>  <span class="co">#PB</span></span>
<span id="cb71-145"><a href="#cb71-145" aria-hidden="true" tabindex="-1"></a>  prod.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[, PB], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> living[, TL])</span>
<span id="cb71-146"><a href="#cb71-146" aria-hidden="true" tabindex="-1"></a>  prod.slope <span class="ot">&lt;-</span> prod.mod<span class="sc">$</span>coef[<span class="dv">2</span>]</span>
<span id="cb71-147"><a href="#cb71-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-148"><a href="#cb71-148" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Check PQ in range of .1 - .3</span></span>
<span id="cb71-149"><a href="#cb71-149" aria-hidden="true" tabindex="-1"></a>  Bad.PQ <span class="ot">&lt;-</span> living[GE <span class="sc">&gt;</span> <span class="fl">0.3</span> <span class="sc">|</span> GE <span class="sc">&lt;</span> <span class="fl">0.1</span>, .(Group, PB, QB, GE)]</span>
<span id="cb71-150"><a href="#cb71-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-151"><a href="#cb71-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-152"><a href="#cb71-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">'Biomass Span'</span> <span class="ot">=</span> bio.mag,</span>
<span id="cb71-153"><a href="#cb71-153" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Biomass Slope'</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(bio.mod<span class="sc">$</span>coef[<span class="dv">2</span>]),</span>
<span id="cb71-154"><a href="#cb71-154" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Trophic Level Slope'</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(TL.mod<span class="sc">$</span>coef[<span class="dv">2</span>]),</span>
<span id="cb71-155"><a href="#cb71-155" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Too High F'</span> <span class="ot">=</span> Bad.F,</span>
<span id="cb71-156"><a href="#cb71-156" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Predator Prey'</span> <span class="ot">=</span> PredPrey,</span>
<span id="cb71-157"><a href="#cb71-157" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Energy Flows - Fish'</span> <span class="ot">=</span> Fish,</span>
<span id="cb71-158"><a href="#cb71-158" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Energy Flows - Invert'</span> <span class="ot">=</span> Invert,</span>
<span id="cb71-159"><a href="#cb71-159" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Energy Flows - Diet'</span> <span class="ot">=</span> Diet,</span>
<span id="cb71-160"><a href="#cb71-160" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Vital Rates - QB'</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(cons.slope),</span>
<span id="cb71-161"><a href="#cb71-161" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Vital Rates - PB'</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(prod.slope),</span>
<span id="cb71-162"><a href="#cb71-162" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Outside PQ range'</span> <span class="ot">=</span> Bad.PQ))</span>
<span id="cb71-163"><a href="#cb71-163" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-164"><a href="#cb71-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-165"><a href="#cb71-165" aria-hidden="true" tabindex="-1"></a>slopePlot <span class="ot">&lt;-</span> <span class="cf">function</span>(rpath.obj, <span class="at">type =</span> <span class="st">'Biomass'</span>, <span class="at">group =</span> <span class="cn">NA</span>, <span class="at">ref =</span> F){</span>
<span id="cb71-166"><a href="#cb71-166" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">as.data.table</span>(Rpath<span class="sc">::</span><span class="fu">write.Rpath</span>(rpath.obj))</span>
<span id="cb71-167"><a href="#cb71-167" aria-hidden="true" tabindex="-1"></a>  living <span class="ot">&lt;-</span> model[type <span class="sc">&lt;</span> <span class="dv">2</span>, ]</span>
<span id="cb71-168"><a href="#cb71-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-169"><a href="#cb71-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'Biomass'</span>){</span>
<span id="cb71-170"><a href="#cb71-170" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Slope of Biomass</span></span>
<span id="cb71-171"><a href="#cb71-171" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[, Biomass], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> living[, TL])</span>
<span id="cb71-172"><a href="#cb71-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-173"><a href="#cb71-173" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-174"><a href="#cb71-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-175"><a href="#cb71-175" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-176"><a href="#cb71-176" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> living,</span>
<span id="cb71-177"><a href="#cb71-177" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL, <span class="at">y =</span> Biomass)) <span class="sc">+</span></span>
<span id="cb71-178"><a href="#cb71-178" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> Group)) </span>
<span id="cb71-179"><a href="#cb71-179" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-180"><a href="#cb71-180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-181"><a href="#cb71-181" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'TL'</span>){</span>
<span id="cb71-182"><a href="#cb71-182" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Slope by Trophic level</span></span>
<span id="cb71-183"><a href="#cb71-183" aria-hidden="true" tabindex="-1"></a>    TL.level <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fl">5.5</span>, .<span class="dv">25</span>))</span>
<span id="cb71-184"><a href="#cb71-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(iTL <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(TL.level) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb71-185"><a href="#cb71-185" aria-hidden="true" tabindex="-1"></a>      living[TL <span class="sc">&gt;=</span> TL.level[iTL] <span class="sc">&amp;</span> TL <span class="sc">&lt;</span> TL.level[iTL <span class="sc">+</span> <span class="dv">1</span>], TL.group <span class="sc">:</span><span class="er">=</span> TL.level[iTL]]</span>
<span id="cb71-186"><a href="#cb71-186" aria-hidden="true" tabindex="-1"></a>      living[TL <span class="sc">&gt;=</span> TL.level[iTL] <span class="sc">&amp;</span> TL <span class="sc">&lt;</span> TL.level[iTL <span class="sc">+</span> <span class="dv">1</span>], TL.bio <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>(Biomass)][]</span>
<span id="cb71-187"><a href="#cb71-187" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb71-188"><a href="#cb71-188" aria-hidden="true" tabindex="-1"></a>    TL.model <span class="ot">&lt;-</span> <span class="fu">unique</span>(living[, .(TL.group, TL.bio)])</span>
<span id="cb71-189"><a href="#cb71-189" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-190"><a href="#cb71-190" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(TL.model[, TL.bio], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> TL.model[, TL.group])</span>
<span id="cb71-191"><a href="#cb71-191" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-192"><a href="#cb71-192" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-193"><a href="#cb71-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-194"><a href="#cb71-194" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-195"><a href="#cb71-195" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> TL.model,</span>
<span id="cb71-196"><a href="#cb71-196" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL.group, <span class="at">y =</span> TL.bio)) <span class="sc">+</span></span>
<span id="cb71-197"><a href="#cb71-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() </span>
<span id="cb71-198"><a href="#cb71-198" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-199"><a href="#cb71-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-200"><a href="#cb71-200" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'Order'</span>){</span>
<span id="cb71-201"><a href="#cb71-201" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">setkey</span>(living, TL)</span>
<span id="cb71-202"><a href="#cb71-202" aria-hidden="true" tabindex="-1"></a>    living[, TL.order <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(living)]</span>
<span id="cb71-203"><a href="#cb71-203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-204"><a href="#cb71-204" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[, Biomass], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> living[, TL.order])</span>
<span id="cb71-205"><a href="#cb71-205" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-206"><a href="#cb71-206" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-207"><a href="#cb71-207" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-208"><a href="#cb71-208" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-209"><a href="#cb71-209" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> living,</span>
<span id="cb71-210"><a href="#cb71-210" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL.order, <span class="at">y =</span> Biomass)) <span class="sc">+</span></span>
<span id="cb71-211"><a href="#cb71-211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) </span>
<span id="cb71-212"><a href="#cb71-212" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb71-213"><a href="#cb71-213" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-214"><a href="#cb71-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-215"><a href="#cb71-215" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'TL Order'</span>){</span>
<span id="cb71-216"><a href="#cb71-216" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">setkey</span>(TL.model, TL.group)</span>
<span id="cb71-217"><a href="#cb71-217" aria-hidden="true" tabindex="-1"></a>    TL.model[, TL.order <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(TL.model)]</span>
<span id="cb71-218"><a href="#cb71-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-219"><a href="#cb71-219" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(TL.model[, TL.bio], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> TL.model[, TL.order])</span>
<span id="cb71-220"><a href="#cb71-220" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-221"><a href="#cb71-221" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-222"><a href="#cb71-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-223"><a href="#cb71-223" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-224"><a href="#cb71-224" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> TL.model,</span>
<span id="cb71-225"><a href="#cb71-225" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL.order, <span class="at">y =</span> TL.bio)) <span class="sc">+</span></span>
<span id="cb71-226"><a href="#cb71-226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) </span>
<span id="cb71-227"><a href="#cb71-227" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(lm.mod<span class="sc">$</span>coef[<span class="dv">2</span>])</span>
<span id="cb71-228"><a href="#cb71-228" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-229"><a href="#cb71-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-230"><a href="#cb71-230" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'PB'</span>){</span>
<span id="cb71-231"><a href="#cb71-231" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Slope of PB</span></span>
<span id="cb71-232"><a href="#cb71-232" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[, PB], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> living[, TL])</span>
<span id="cb71-233"><a href="#cb71-233" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-234"><a href="#cb71-234" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-235"><a href="#cb71-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-236"><a href="#cb71-236" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-237"><a href="#cb71-237" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> living,</span>
<span id="cb71-238"><a href="#cb71-238" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL, <span class="at">y =</span> PB)) <span class="sc">+</span></span>
<span id="cb71-239"><a href="#cb71-239" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> Group))</span>
<span id="cb71-240"><a href="#cb71-240" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-241"><a href="#cb71-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-242"><a href="#cb71-242" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'QB'</span>){</span>
<span id="cb71-243"><a href="#cb71-243" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Slope of QB</span></span>
<span id="cb71-244"><a href="#cb71-244" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[Group <span class="sc">!=</span> <span class="st">'Phytoplankton'</span>, QB], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> </span>
<span id="cb71-245"><a href="#cb71-245" aria-hidden="true" tabindex="-1"></a>                     living[Group <span class="sc">!=</span> <span class="st">'Phytoplankton'</span>, TL])</span>
<span id="cb71-246"><a href="#cb71-246" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-247"><a href="#cb71-247" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-248"><a href="#cb71-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-249"><a href="#cb71-249" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-250"><a href="#cb71-250" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> living[Group <span class="sc">!=</span> <span class="st">'Phytoplankton'</span>, ],</span>
<span id="cb71-251"><a href="#cb71-251" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL, <span class="at">y =</span> QB)) <span class="sc">+</span></span>
<span id="cb71-252"><a href="#cb71-252" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> Group))</span>
<span id="cb71-253"><a href="#cb71-253" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-254"><a href="#cb71-254" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb71-255"><a href="#cb71-255" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">'Lifespan'</span>){</span>
<span id="cb71-256"><a href="#cb71-256" aria-hidden="true" tabindex="-1"></a>    living[, Lifespan <span class="sc">:</span><span class="er">=</span> <span class="fu">lscalc</span>(PB)]</span>
<span id="cb71-257"><a href="#cb71-257" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Slope of Biomass</span></span>
<span id="cb71-258"><a href="#cb71-258" aria-hidden="true" tabindex="-1"></a>    lm.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(living[, Lifespan], <span class="at">base =</span> <span class="dv">10</span>) <span class="sc">~</span> living[, TL])</span>
<span id="cb71-259"><a href="#cb71-259" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+- 1 Standard Error</span></span>
<span id="cb71-260"><a href="#cb71-260" aria-hidden="true" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(lm.mod))[, <span class="dv">2</span>]</span>
<span id="cb71-261"><a href="#cb71-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-262"><a href="#cb71-262" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot basics</span></span>
<span id="cb71-263"><a href="#cb71-263" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> living,</span>
<span id="cb71-264"><a href="#cb71-264" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> TL, <span class="at">y =</span> Lifespan)) <span class="sc">+</span></span>
<span id="cb71-265"><a href="#cb71-265" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> Group))</span>
<span id="cb71-266"><a href="#cb71-266" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-267"><a href="#cb71-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-268"><a href="#cb71-268" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Add slope line with standard deviations</span></span>
<span id="cb71-269"><a href="#cb71-269" aria-hidden="true" tabindex="-1"></a>  slope <span class="ot">&lt;-</span> slope <span class="sc">+</span></span>
<span id="cb71-270"><a href="#cb71-270" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb71-271"><a href="#cb71-271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">1</span>], </span>
<span id="cb71-272"><a href="#cb71-272" aria-hidden="true" tabindex="-1"></a>                <span class="at">slope =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb71-273"><a href="#cb71-273" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> std[<span class="dv">1</span>], </span>
<span id="cb71-274"><a href="#cb71-274" aria-hidden="true" tabindex="-1"></a>                <span class="at">slope =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">+</span> std[<span class="dv">2</span>], <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb71-275"><a href="#cb71-275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">-</span> std[<span class="dv">1</span>], </span>
<span id="cb71-276"><a href="#cb71-276" aria-hidden="true" tabindex="-1"></a>                <span class="at">slope =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">-</span> std[<span class="dv">2</span>], <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb71-277"><a href="#cb71-277" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-278"><a href="#cb71-278" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-279"><a href="#cb71-279" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Add reference lines for 5 and 10%</span></span>
<span id="cb71-280"><a href="#cb71-280" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(ref){</span>
<span id="cb71-281"><a href="#cb71-281" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> slope <span class="sc">+</span></span>
<span id="cb71-282"><a href="#cb71-282" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">1</span>],</span>
<span id="cb71-283"><a href="#cb71-283" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">col =</span> <span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb71-284"><a href="#cb71-284" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> lm.mod<span class="sc">$</span>coef[<span class="dv">1</span>],</span>
<span id="cb71-285"><a href="#cb71-285" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb71-286"><a href="#cb71-286" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-287"><a href="#cb71-287" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-288"><a href="#cb71-288" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Highlight a group</span></span>
<span id="cb71-289"><a href="#cb71-289" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(group)){</span>
<span id="cb71-290"><a href="#cb71-290" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> slope <span class="sc">+</span></span>
<span id="cb71-291"><a href="#cb71-291" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_label</span>(<span class="at">data =</span> living[Group <span class="sc">==</span> group, ], <span class="fu">aes</span>(<span class="at">label =</span> Group),</span>
<span id="cb71-292"><a href="#cb71-292" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fontface =</span> <span class="st">'bold'</span>)</span>
<span id="cb71-293"><a href="#cb71-293" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-294"><a href="#cb71-294" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-295"><a href="#cb71-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(slope)</span>
<span id="cb71-296"><a href="#cb71-296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-297"><a href="#cb71-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-298"><a href="#cb71-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-299"><a href="#cb71-299" aria-hidden="true" tabindex="-1"></a><span class="co"># taxaplots &lt;- function()</span></span>
<span id="cb71-300"><a href="#cb71-300" aria-hidden="true" tabindex="-1"></a><span class="co"># opar &lt;- par(mfrow = c(2, 2), mar = c(5, 0, 0, 2), oma = c(2, 4, 2, 0))</span></span>
<span id="cb71-301"><a href="#cb71-301" aria-hidden="true" tabindex="-1"></a><span class="co"># barplot(PredPrey[, Value], names.arg = PredPrey[, Ratio], las = 2)</span></span>
<span id="cb71-302"><a href="#cb71-302" aria-hidden="true" tabindex="-1"></a><span class="co"># legend('topright', legend = 'A', bty = 'n', cex = 2)</span></span>
<span id="cb71-303"><a href="#cb71-303" aria-hidden="true" tabindex="-1"></a><span class="co"># barplot(Fish[, Value], names.arg = Fish[, Ratio], las = 2)</span></span>
<span id="cb71-304"><a href="#cb71-304" aria-hidden="true" tabindex="-1"></a><span class="co"># legend('topright', legend = 'B', bty = 'n', cex = 2)</span></span>
<span id="cb71-305"><a href="#cb71-305" aria-hidden="true" tabindex="-1"></a><span class="co"># barplot(Invert[, Value], names.arg = Invert[, Ratio], las = 2)</span></span>
<span id="cb71-306"><a href="#cb71-306" aria-hidden="true" tabindex="-1"></a><span class="co"># legend('topright', legend = 'C', bty = 'n', cex = 2)</span></span>
<span id="cb71-307"><a href="#cb71-307" aria-hidden="true" tabindex="-1"></a><span class="co"># barplot(Diet[, Value], names.arg = Diet[, Ratio], las = 2)</span></span>
<span id="cb71-308"><a href="#cb71-308" aria-hidden="true" tabindex="-1"></a><span class="co"># legend('topright', legend = 'D', bty = 'n', cex = 2)</span></span>
<span id="cb71-309"><a href="#cb71-309" aria-hidden="true" tabindex="-1"></a><span class="co"># mtext(2, outer = T, text = 'Ratio', line = 2.5)</span></span>
<span id="cb71-310"><a href="#cb71-310" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb71-311"><a href="#cb71-311" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb71-312"><a href="#cb71-312" aria-hidden="true" tabindex="-1"></a><span class="co"># #QB slope</span></span>
<span id="cb71-313"><a href="#cb71-313" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(living.GB[Group != 'Phytoplankton', list(TL, QB)], log = "y", typ = 'n')</span></span>
<span id="cb71-314"><a href="#cb71-314" aria-hidden="true" tabindex="-1"></a><span class="co"># text(living.GB[Group != 'Phytoplankton', TL], living.GB[Group != 'Phytoplankton', QB], </span></span>
<span id="cb71-315"><a href="#cb71-315" aria-hidden="true" tabindex="-1"></a><span class="co">#      living.GB[, Group], cex = .5)</span></span>
<span id="cb71-316"><a href="#cb71-316" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(cons.mod)</span></span>
<span id="cb71-317"><a href="#cb71-317" aria-hidden="true" tabindex="-1"></a><span class="co"># #+- 1 Standard Error</span></span>
<span id="cb71-318"><a href="#cb71-318" aria-hidden="true" tabindex="-1"></a><span class="co"># std &lt;- coef(summary(cons.mod))[, 2]</span></span>
<span id="cb71-319"><a href="#cb71-319" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(a = coef(cons.mod)[1] + std[1], b = coef(cons.mod)[2] + std[2], lty = 2)</span></span>
<span id="cb71-320"><a href="#cb71-320" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(a = coef(cons.mod)[1] - std[1], b = coef(cons.mod)[2] - std[2], lty = 2)</span></span>
<span id="cb71-321"><a href="#cb71-321" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb71-322"><a href="#cb71-322" aria-hidden="true" tabindex="-1"></a><span class="co"># #PB</span></span>
<span id="cb71-323"><a href="#cb71-323" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(living.GB[, list(TL, PB)], log = "y", typ = 'n')</span></span>
<span id="cb71-324"><a href="#cb71-324" aria-hidden="true" tabindex="-1"></a><span class="co"># text(living.GB[, TL], living.GB[, PB], living.GB[, Group], cex = .5)</span></span>
<span id="cb71-325"><a href="#cb71-325" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(prod.mod)</span></span>
<span id="cb71-326"><a href="#cb71-326" aria-hidden="true" tabindex="-1"></a><span class="co"># #+- 1 Standard Error</span></span>
<span id="cb71-327"><a href="#cb71-327" aria-hidden="true" tabindex="-1"></a><span class="co"># std &lt;- coef(summary(prod.mod))[, 2]</span></span>
<span id="cb71-328"><a href="#cb71-328" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(a = coef(prod.mod)[1] + std[1], b = coef(prod.mod)[2] + std[2], lty = 2)</span></span>
<span id="cb71-329"><a href="#cb71-329" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(a = coef(prod.mod)[1] - std[1], b = coef(prod.mod)[2] - std[2], lty = 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Estimate mortality by MAFMC species with modified function that keeps M0</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>check.mort <span class="ot">&lt;-</span> <span class="cf">function</span>(rpath.obj, group){</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  model.out <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">as.data.table</span>(Rpath<span class="sc">::</span><span class="fu">write.Rpath</span>(rpath.obj, <span class="at">morts =</span> T))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  group.mort <span class="ot">&lt;-</span> model.out[Group <span class="sc">==</span> group]</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt</span>(group.mort, <span class="at">id.vars =</span> <span class="st">'Group'</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">setorder</span>(out[value <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'PB'</span>), ], <span class="sc">-</span>value)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>fluke <span class="ot">&lt;-</span> <span class="fu">check.mort</span>(MAB.rpath, <span class="st">"SummerFlounder"</span>) <span class="sc">|&gt;</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="fu">as.character</span>(variable), <span class="st">"</span><span class="sc">\\</span><span class="st">M2.</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"predation"</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                                        stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="fu">as.character</span>(variable), <span class="st">"</span><span class="sc">\\</span><span class="st">bOther</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"other"</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                                        stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="fu">as.character</span>(variable), <span class="st">"</span><span class="sc">\\</span><span class="st">bM0</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"unaccounted"</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"fishery"</span>)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>                                        )</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co">#only works with MAB right now</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>sppmort <span class="ot">&lt;-</span> <span class="cf">function</span>(spp){</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check.mort</span>(MAB.rpath, spp) <span class="sc">|&gt;</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="fu">as.character</span>(variable), <span class="st">"</span><span class="sc">\\</span><span class="st">M2.</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"predation"</span>,</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>                                        stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="fu">as.character</span>(variable), <span class="st">"</span><span class="sc">\\</span><span class="st">bOther</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"other"</span>,</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>                                        stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="fu">as.character</span>(variable), <span class="st">"</span><span class="sc">\\</span><span class="st">bM0</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"unaccounted"</span>,</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"fishery"</span>)</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>                                        )</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>mafmcmort <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(mafmc, sppmort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Mort plot</p>
<div class="cell" data-fig.asp="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>MAFMCmodmort <span class="ot">&lt;-</span> mafmcmort <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#convert value to proportion of total mort</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Group) <span class="sc">|&gt;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">totmort =</span> <span class="fu">sum</span>(value),</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">propmort =</span> value<span class="sc">/</span> totmort) <span class="sc">|&gt;</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dplyr::filter(type=="predation") |&gt;</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#split variable to get predator name</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_wider_delim</span>(variable, <span class="st">"."</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"mort"</span>, <span class="st">"Pred"</span>),</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">too_few =</span> <span class="st">"align_start"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mafmcpred =</span> <span class="fu">ifelse</span>(Pred <span class="sc">%in%</span> mafmc, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">plotcol =</span> <span class="fu">ifelse</span>(mafmcpred, <span class="st">"blue"</span>, <span class="st">"lightgrey"</span>),</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">Pred =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Pred), mort, Pred))</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>mortplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(MAFMCmodmort, <span class="fu">aes</span>(<span class="st">""</span>, propmort, <span class="at">fill=</span>mafmcpred)) <span class="sc">+</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#coord_polar("y") +</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>( propmort<span class="sc">&gt;</span><span class="fl">0.05</span>, <span class="fu">paste0</span>(Pred, <span class="st">" "</span>, <span class="fu">round</span>(propmort<span class="sc">*</span><span class="dv">100</span>), <span class="st">"%"</span>), <span class="st">""</span>)), <span class="co">#\n</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>, </span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Mortality"</span>) <span class="sc">+</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">"grey90"</span>, <span class="st">"lightblue"</span>)) <span class="sc">+</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_fill_viridis(discrete=TRUE) +</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"#666666"</span>),</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Group)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>mortplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="RiskIndicators_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>